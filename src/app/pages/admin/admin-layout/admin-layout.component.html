<div class="admin-layout">
    <aside class="sidebar" [class.collapsed]="isSidebarCollapsed">
        <!-- Sidebar Navigation -->
        <div class="sidebar-header">
            <div class="header-content">
                <h3>Admin</h3>
                <button class="toggle-btn" (click)="toggleSidebar()">
                    <app-icon [name]="isSidebarCollapsed ? 'menu' : 'chevron-left'" [size]="20"></app-icon>
                </button>
            </div>
        </div>
        <nav class="sidebar-nav">
            <!-- Dashboard (Always visible) -->
            <a routerLink="/admin/dashboard" routerLinkActive="active" [title]="'ADMIN.SIDEBAR.DASHBOARD' | translate">
                <span class="icon">üìä</span>
                <span class="text">{{ 'ADMIN.SIDEBAR.DASHBOARD' | translate }}</span>
            </a>

            <!-- E-COMMERCE Section -->
            <div class="nav-section">
                <button class="section-header" (click)="toggleSection('ecommerce')"
                    [class.collapsed]="!sections.ecommerce" [title]="'ADMIN.SIDEBAR.SECTION_ECOMMERCE' | translate">
                    <span class="section-icon">üì¶</span>
                    <span class="section-title">{{ 'ADMIN.SIDEBAR.SECTION_ECOMMERCE' | translate }}</span>
                    <span class="toggle-icon">{{ sections.ecommerce ? '‚ñº' : '‚ñ∂' }}</span>
                </button>
                <div class="section-items" [class.expanded]="sections.ecommerce">
                    <a routerLink="/admin/catalog-overview" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.CATALOG_OVERVIEW' | translate">
                        <span class="icon">üóÇÔ∏è</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.CATALOG_OVERVIEW' | translate }}</span>
                    </a>
                    <a routerLink="/admin/orders" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.ORDERS' | translate">
                        <span class="icon">üì¶</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.ORDERS' | translate }}</span>
                    </a>
                    <a routerLink="/admin/brands" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.BRANDS' | translate">
                        <span class="icon">üè∑Ô∏è</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.BRANDS' | translate }}</span>
                    </a>
                    <a routerLink="/admin/categories" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.CATEGORIES' | translate">
                        <span class="icon">üìÇ</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.CATEGORIES' | translate }}</span>
                    </a>
                    <a routerLink="/admin/products" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.PRODUCTS' | translate">
                        <span class="icon">üõí</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.PRODUCTS' | translate }}</span>
                    </a>
                    <a routerLink="/admin/kits" routerLinkActive="active" title="Kits">
                        <span class="icon">üéÅ</span>
                        <span class="text">Kits</span>
                    </a>
                    <a routerLink="/admin/coupons" routerLinkActive="active"
                        [title]="'ADMIN.COUPONS.TITLE' | translate">
                        <span class="icon">üéüÔ∏è</span>
                        <span class="text">{{ 'ADMIN.COUPONS.TITLE' | translate }}</span>
                    </a>
                </div>
            </div>

            <!-- CONTENT Section -->
            <div class="nav-section">
                <button class="section-header" (click)="toggleSection('content')" [class.collapsed]="!sections.content"
                    [title]="'ADMIN.SIDEBAR.SECTION_CONTENT' | translate">
                    <span class="section-icon">üìù</span>
                    <span class="section-title">{{ 'ADMIN.SIDEBAR.SECTION_CONTENT' | translate }}</span>
                    <span class="toggle-icon">{{ sections.content ? '‚ñº' : '‚ñ∂' }}</span>
                </button>
                <div class="section-items" [class.expanded]="sections.content">
                    <a routerLink="/admin/banners" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.BANNERS' | translate">
                        <span class="icon">üñºÔ∏è</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.BANNERS' | translate }}</span>
                    </a>
                    <a routerLink="/admin/blog" routerLinkActive="active" [title]="'ADMIN.SIDEBAR.BLOG' | translate">
                        <span class="icon">‚úçÔ∏è</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.BLOG' | translate }}</span>
                    </a>
                    <a routerLink="/admin/pdfs" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.PDF_LIBRARY' | translate">
                        <span class="icon">üìö</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.PDF_LIBRARY' | translate }}</span>
                    </a>
                </div>
            </div>

            <!-- BUSINESS Section -->
            <div class="nav-section">
                <button class="section-header" (click)="toggleSection('business')"
                    [class.collapsed]="!sections.business">
                    <span class="section-icon">üë•</span>
                    <span class="section-title">{{ 'ADMIN.SIDEBAR.SECTION_BUSINESS' | translate }}</span>
                    <span class="toggle-icon">{{ sections.business ? '‚ñº' : '‚ñ∂' }}</span>
                </button>
                <div class="section-items" [class.expanded]="sections.business">
                    <a routerLink="/admin/distributors" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.DISTRIBUTORS' | translate">
                        <span class="icon">üìã</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.DISTRIBUTORS' | translate }}</span>
                    </a>
                    <a routerLink="/admin/customers" routerLinkActive="active"
                        [title]="'ADMIN.SIDEBAR.CUSTOMERS' | translate">
                        <span class="icon">üë•</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.CUSTOMERS' | translate }}</span>
                    </a>
                </div>
            </div>

            <!-- SYSTEM Section -->
            <div class="nav-section">
                <button class="section-header" (click)="toggleSection('system')" [class.collapsed]="!sections.system"
                    [title]="'ADMIN.SIDEBAR.SECTION_SYSTEM' | translate">
                    <span class="section-icon">‚öôÔ∏è</span>
                    <span class="section-title">{{ 'ADMIN.SIDEBAR.SECTION_SYSTEM' | translate }}</span>
                    <span class="toggle-icon">{{ sections.system ? '‚ñº' : '‚ñ∂' }}</span>
                </button>
                <div class="section-items" [class.expanded]="sections.system">
                    <a routerLink="/admin/users" routerLinkActive="active" [title]="'ADMIN.SIDEBAR.STAFF' | translate"
                        *appHasRole="['SUPER_ADMIN']">
                        <span class="icon">üõ°Ô∏è</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.STAFF' | translate }}</span>
                    </a>
                    <a routerLink="/admin/settings" routerLinkActive="active" [title]="'SETTINGS.TITLE' | translate">
                        <span class="icon">‚öôÔ∏è</span>
                        <span class="text">{{ 'SETTINGS.TITLE' | translate }}</span>
                    </a>
                    <a routerLink="/admin/logs" routerLinkActive="active" [title]="'ADMIN.SIDEBAR.LOGS' | translate">
                        <span class="icon">üìä</span>
                        <span class="text">{{ 'ADMIN.SIDEBAR.LOGS' | translate }}</span>
                    </a>
                </div>
            </div>
        </nav>
        <div class="sidebar-footer">
            @if (user$ | async; as user) {
            <div class="user-profile" [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                <div class="user-avatar">
                    @if (user.photoURL) {
                    <img [src]="user.photoURL" [alt]="(userProfile$ | async)?.displayName || user.displayName">
                    } @else {
                    <div class="avatar-placeholder">{{ getUserInitials((userProfile$ | async)?.displayName ||
                        user.displayName || user.email) }}</div>
                    }
                </div>
                <div class="user-info">
                    <span class="user-name">{{ (userProfile$ | async)?.displayName || user.displayName || 'Admin'
                        }}</span>
                    <span class="user-email">{{ user.email }}</span>
                </div>
            </div>
            }
            <button (click)="logout()" class="logout-btn" [title]="'ADMIN.SIDEBAR.LOGOUT' | translate">
                <span class="icon">üö™</span>
                <span class="text">{{ 'ADMIN.SIDEBAR.LOGOUT' | translate }}</span>
            </button>
        </div>
    </aside>
    <main class="admin-content" [class.expanded]="isSidebarCollapsed">
        <header class="admin-header">
            <div class="spacer"></div>

            <div class="header-actions-group">
                <button (click)="toggleLanguage()" class="lang-btn-header">
                    {{ languageService.currentLang() === 'es' ? 'EN' : 'ES' }}
                </button>

                @if (user$ | async; as user) {
                <div class="user-menu-container">
                    <button class="header-avatar" (click)="toggleUserMenu()"
                        [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                        @if (user.photoURL) {
                        <img [src]="user.photoURL"
                            [alt]="(userProfile$ | async)?.displayName || user.displayName || 'Admin'">
                        } @else {
                        <div class="avatar-placeholder-sm">{{ getUserInitials((userProfile$ | async)?.displayName ||
                            user.displayName) }}</div>
                        }
                    </button>

                    @if (isUserMenuOpen) {
                    <div class="user-dropdown">
                        <div class="dropdown-header">
                            <span class="d-name">{{ (userProfile$ | async)?.displayName || user.displayName || 'Admin'
                                }}</span>
                            @if (userProfile$ | async; as profile) {
                            <span class="d-role-badge">{{ profile.role }}</span>
                            } @else {
                            <span class="d-role-badge inactive">No Profile Sync</span>
                            }
                            <span class="d-email">{{ user.email }}</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a routerLink="/" class="dropdown-item">
                            <span class="icon">üè†</span>
                            {{ 'ADMIN.GO_HOME' | translate }}
                        </a>
                        <button (click)="logout()" class="dropdown-item">
                            <span class="icon">üö™</span>
                            {{ 'ADMIN.SIDEBAR.LOGOUT' | translate }}
                        </button>
                    </div>
                    }
                </div>
                }
            </div>
        </header>

        <div class="content-wrapper">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>