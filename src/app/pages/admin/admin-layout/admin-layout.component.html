<div class="admin-layout">
    <app-sidebar [items]="navigationItems" (collapseChange)="onSidebarCollapse($event)" (onLogout)="logout()">
    </app-sidebar>

    <main class="admin-content" [class.expanded]="isSidebarCollapsed">
        <header class="admin-header">
            <!-- Optional: Hamburger if we wanted one here, but Sidebar handles it -->
            <div class="spacer"></div>

            <div class="header-actions-group">
                <button (click)="toggleLanguage()" class="lang-btn-header">
                    {{ languageService.currentLang() === 'es' ? 'EN' : 'ES' }}
                </button>

                @if (user$ | async; as user) {
                <div class="user-menu-container">
                    <button class="header-avatar" (click)="toggleUserMenu()"
                        [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                        @if (user.photoURL) {
                        <img [src]="user.photoURL"
                            [alt]="(userProfile$ | async)?.displayName || user.displayName || 'Admin'">
                        } @else {
                        <div class="avatar-placeholder-sm">{{ getUserInitials((userProfile$ | async)?.displayName ||
                            user.displayName) }}</div>
                        }
                    </button>

                    @if (isUserMenuOpen) {
                    <div class="user-dropdown">
                        <div class="dropdown-header">
                            <span class="d-name">{{ (userProfile$ | async)?.displayName || user.displayName || 'Admin'
                                }}</span>
                            @if (userProfile$ | async; as profile) {
                            <span class="d-role-badge">{{ profile.role }}</span>
                            } @else {
                            <span class="d-role-badge inactive">No Profile Sync</span>
                            }
                            <span class="d-email">{{ user.email }}</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a routerLink="/" class="dropdown-item">
                            <span class="icon">üè†</span>
                            {{ 'ADMIN.GO_HOME' | translate }}
                        </a>
                        <button (click)="logout()" class="dropdown-item">
                            <span class="icon">üö™</span>
                            {{ 'ADMIN.SIDEBAR.LOGOUT' | translate }}
                        </button>
                    </div>
                    }
                </div>
                }
            </div>
        </header>

        <div class="content-wrapper">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>