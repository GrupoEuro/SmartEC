<div class="product-dashboard-layout">
    <header class="command-header">
        <div class="header-left">
            <div class="header-title-section">
                <h1 class="page-title">{{ 'ADMIN.BLOG.TITLE' | translate }}</h1>
                <span class="product-badge" *ngIf="paginationConfig.totalItems > 0">
                    {{ paginationConfig.totalItems }}
                </span>
            </div>
        </div>

        <div class="header-right" style="display: flex; gap: 12px; align-items: center;">
            <button class="btn-ghost" (click)="exportToCSV()" [title]="'ADMIN.COMMON.EXPORT' | translate">
                <span class="icon">üì§</span>
                <span class="text">Export</span>
            </button>

            <button class="btn-primary-action" routerLink="/admin/blog/new">
                <span class="icon">‚ûï</span>
                <span class="text">{{ 'ADMIN.BLOG.BTN_ADD' | translate }}</span>
            </button>
        </div>
    </header>

    <div class="dashboard-content">
        <!-- Main Grid Area -->
        <main class="product-grid-view">

            <!-- Toolbar -->
            <div class="table-toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                        [placeholder]="'ADMIN.BLOG.SEARCH_PLACEHOLDER' | translate">
                </div>

                <select class="filter-select" [(ngModel)]="selectedCategory" (ngModelChange)="onFilterChange()">
                    <option value="">All Categories</option>
                    <option *ngFor="let cat of uniqueCategories" [value]="cat">{{ cat }}</option>
                </select>
            </div>

            <!-- Table -->
            <div class="table-glass-container">
                <table class="rich-table">
                    <thead>
                        <tr>
                            <th class="w-20">{{ 'ADMIN.BLOG.TH_COVER' | translate }}</th>
                            <th class="sortable" (click)="onSortChange('title')">
                                {{ 'ADMIN.BLOG.TH_TITLE' | translate }} <span *ngIf="sortField === 'title'">{{
                                    sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                            </th>
                            <th>{{ 'ADMIN.BLOG.TH_CATEGORY' | translate }}</th>
                            <th class="sortable" (click)="onSortChange('date')">
                                {{ 'ADMIN.BLOG.TH_DATE' | translate }} <span *ngIf="sortField === 'date'">{{
                                    sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                            </th>
                            <th>{{ 'ADMIN.BLOG.TH_ACTIONS' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loading State -->
                        <tr *ngIf="isLoading">
                            <td colspan="5" class="loading-state">
                                <div class="empty-state-content">
                                    <app-icon name="loader" [size]="48" class="text-muted spinning"></app-icon>
                                    <p>Loading blog posts...</p>
                                </div>
                            </td>
                        </tr>

                        <!-- Error State -->
                        <tr *ngIf="error && !isLoading">
                            <td colspan="5" class="no-data">
                                <div class="empty-state-content">
                                    <app-icon name="alert-circle" [size]="48" class="text-danger"></app-icon>
                                    <p>{{ error }}</p>
                                    <button class="btn-retry" (click)="loadData(); setupFiltering()">
                                        <app-icon name="refresh-cw" [size]="16"></app-icon>
                                        Retry
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- Data Rows -->
                        <tr *ngFor="let post of paginatedPosts$ | async" [hidden]="isLoading || error">
                            <td>
                                <div class="img-thumbnail">
                                    <img [src]="post.coverImage" [alt]="post.title">
                                </div>
                            </td>
                            <td>
                                <div class="product-identity">
                                    <span class="product-name strong" [routerLink]="['/admin/blog/edit', post.id]">
                                        {{ post.title }}
                                    </span>
                                    <span class="product-sku">{{ post.slug }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="category-pill" *ngIf="post.category">{{ post.category }}</span>
                                <span class="text-muted" *ngIf="!post.category">No category</span>
                            </td>
                            <td>
                                <div class="date-info">
                                    <span class="date-main">{{ post.date | date:'mediumDate' }}</span>
                                    <span class="read-time" *ngIf="post.readTime">{{ post.readTime }} min read</span>
                                </div>
                            </td>
                            <td class="text-right">
                                <div class="row-actions">
                                    <button class="btn-icon-ghost" [routerLink]="['/admin/blog/edit', post.id]"
                                        [title]="'ADMIN.COMMON.EDIT' | translate">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn-icon-ghost danger" (click)="deletePost(post)"
                                        [title]="'ADMIN.COMMON.DELETE' | translate">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- Empty State -->
                        <tr *ngIf="(paginatedPosts$ | async)?.length === 0 && !isLoading && !error">
                            <td colspan="5" class="no-data">
                                <div class="empty-state-content">
                                    <app-icon name="file-text" [size]="48" class="text-muted"></app-icon>
                                    <p>{{ 'ADMIN.BLOG.EMPTY' | translate }}</p>
                                    <a [routerLink]="['/admin/blog/new']" class="btn-primary-action">
                                        <app-icon name="plus" [size]="18"></app-icon>
                                        Create your first blog post
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-wrapper" *ngIf="paginationConfig.totalItems > 0">
                <app-pagination [config]="paginationConfig" (pageChange)="onPageChange($event)"
                    (itemsPerPageChange)="onItemsPerPageChange($event)">
                </app-pagination>
            </div>
        </main>
    </div>
</div>