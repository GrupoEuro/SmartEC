<app-admin-page-header icon="üìä" [title]="'ADMIN.CATALOG_OVERVIEW.TITLE' | translate"
    [subtitle]="'ADMIN.CATALOG_OVERVIEW.SUBTITLE' | translate">
</app-admin-page-header>

<div class="overview-container" *ngIf="!isLoading; else loading">

    <!-- Quick Stats Row -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-value">{{ totalBrands }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.TOTAL_BRANDS' | translate }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ totalCategories }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.TOTAL_CATEGORIES' | translate }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ totalProducts }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.TOTAL_PRODUCTS' | translate }}</div>
        </div>
        <div class="stat-card warning" *ngIf="productsWithoutBrand > 0">
            <div class="stat-value">{{ productsWithoutBrand }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.NO_BRAND' | translate }}</div>
        </div>
        <div class="stat-card warning" *ngIf="productsWithoutCategory > 0">
            <div class="stat-value">{{ productsWithoutCategory }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.NO_CATEGORY' | translate }}</div>
        </div>
    </div>

    <div class="content-grid">
        <!-- Brands Section -->
        <div class="section brands-section">
            <div class="section-header">
                <h2>{{ 'ADMIN.CATALOG_OVERVIEW.BRANDS_SECTION' | translate }}</h2>
                <a routerLink="/admin/brands" class="view-all">{{ 'ADMIN.COMMON.VIEW_ALL' | translate }} ‚Üí</a>
            </div>

            <div class="brands-grid">
                <div class="brand-card" *ngFor="let item of brandStats"
                    [routerLink]="['/admin/brands', item.brand.id, 'edit']">
                    <div class="brand-header">
                        <div class="brand-logo">
                            <img *ngIf="item.brand.logoUrl" [src]="item.brand.logoUrl" [alt]="item.brand.name">
                            <span *ngIf="!item.brand.logoUrl" class="no-logo">{{ item.brand.name.charAt(0) }}</span>
                        </div>
                        <div class="brand-status" [class.active]="item.brand.active"></div>
                    </div>
                    <div class="brand-info">
                        <h3>
                            {{ item.brand.name }}
                            <span *ngIf="item.brand.featured" class="featured-star">‚≠ê</span>
                        </h3>
                        <div class="product-badge" [class.has-products]="item.productCount > 0">
                            {{ item.productCount }} {{ 'ADMIN.CATALOG_OVERVIEW.PRODUCT_UNIT' | translate }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Section -->
        <div class="section categories-section">
            <div class="section-header">
                <h2>{{ 'ADMIN.CATALOG_OVERVIEW.CATEGORIES_HIERARCHY' | translate }}</h2>
                <a routerLink="/admin/categories" class="view-all">{{ 'ADMIN.COMMON.VIEW_ALL' | translate }} ‚Üí</a>
            </div>

            <div class="category-tree">
                <ng-container *ngTemplateOutlet="treeNode; context: { $implicit: categoryTree }"></ng-container>
            </div>
        </div>
    </div>
</div>

<ng-template #treeNode let-nodes>
    <div class="tree-level">
        <div class="tree-item" *ngFor="let node of nodes">
            <div class="node-content" [class.expanded]="node.expanded">
                <div class="node-main" (click)="toggleNode(node)">
                    <span class="expand-icon" [style.visibility]="node.children.length ? 'visible' : 'hidden'">
                        {{ node.expanded ? '‚ñº' : '‚ñ∂' }}
                    </span>

                    <div class="node-icon" *ngIf="node.category.icon">{{ node.category.icon }}</div>

                    <div class="node-details">
                        <span class="node-name">{{ node.category.name.en }}</span>
                        <span class="product-count">({{ node.productCount }})</span>
                    </div>

                    <div class="node-actions">
                        <a [routerLink]="['/admin/categories', node.category.id, 'edit']" class="edit-btn">‚úèÔ∏è</a>
                    </div>
                </div>
            </div>

            <div class="node-children" *ngIf="node.expanded && node.children.length > 0">
                <ng-container *ngTemplateOutlet="treeNode; context: { $implicit: node.children }"></ng-container>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #loading>
    <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'ADMIN.COMMON.LOADING' | translate }}</p>
    </div>
</ng-template>