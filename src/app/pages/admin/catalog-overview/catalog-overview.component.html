<app-admin-page-header icon="üìä" [title]="'ADMIN.CATALOG_OVERVIEW.TITLE' | translate"
    [subtitle]="'ADMIN.CATALOG_OVERVIEW.SUBTITLE' | translate">
</app-admin-page-header>

<div class="overview-container" *ngIf="!isLoading; else loading">

    <!-- Quick Stats Row -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-value">{{ totalProducts }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.TOTAL_PRODUCTS' | translate }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ totalBrands }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.TOTAL_BRANDS' | translate }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ totalCategories }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.TOTAL_CATEGORIES' | translate }}</div>
        </div>
        <div class="stat-card warning" *ngIf="productsWithoutBrand > 0 || productsWithoutCategory > 0">
            <div class="stat-value" style="color: #ef4444;">{{ productsWithoutBrand + productsWithoutCategory }}</div>
            <div class="stat-label">{{ 'ADMIN.CATALOG_OVERVIEW.ISSUES_DETECTED' | translate }}</div>
        </div>
    </div>

    <!-- Master Visualizer Tree -->
    <div class="section visualizer-section">
        <div class="section-header">
            <h2>{{ 'ADMIN.CATALOG_OVERVIEW.HIERARCHY' | translate }}</h2>
            <div class="legend">
                <span class="legend-item"><span class="dot type"></span>{{ 'ADMIN.CATALOG_OVERVIEW.LEGEND.TYPE' |
                    translate }}</span>
                <span class="legend-item"><span class="dot cat"></span>{{ 'ADMIN.CATALOG_OVERVIEW.LEGEND.CATEGORY' |
                    translate }}</span>
                <span class="legend-item"><span class="dot brand"></span>{{ 'ADMIN.CATALOG_OVERVIEW.LEGEND.BRAND' |
                    translate }}</span>
            </div>
        </div>

        <div class="category-tree">
            <ng-container *ngTemplateOutlet="treeNode; context: { $implicit: masterTree }"></ng-container>

            <div *ngIf="masterTree.length === 0" class="empty-state">
                {{ 'ADMIN.CATALOG_OVERVIEW.NO_DATA' | translate }}
            </div>
        </div>
    </div>
</div>

<ng-template #treeNode let-nodes>
    <div class="tree-level">
        <div class="tree-item" *ngFor="let node of nodes">
            <div class="node-content" [class.expanded]="node.expanded" [attr.data-type]="node.type">
                <div class="node-main" (click)="toggleNode(node)">
                    <!-- Expand Icon -->
                    <span class="expand-icon" [style.visibility]="node.children.length ? 'visible' : 'hidden'">
                        {{ node.expanded ? '‚ñº' : '‚ñ∂' }}
                    </span>

                    <!-- Node Icon or Image -->
                    <div class="node-icon-wrapper">
                        <div *ngIf="node.type === 'brand' && node.image" class="node-brand-logo">
                            <img [src]="node.image" alt="logo">
                        </div>
                        <div *ngIf="!node.image" class="node-icon">{{ node.icon || (node.type === 'brand' ? 'üè∑Ô∏è' :
                            'üìÅ') }}</div>
                    </div>

                    <!-- Details -->
                    <div class="node-details">
                        <span class="node-name">{{ node.name }}</span>
                        <span class="product-count badge">{{ node.count }} products</span>
                    </div>

                    <!-- Actions -->
                    <div class="node-actions" *ngIf="node.actions">
                        <a *ngFor="let action of node.actions" [routerLink]="action.link" class="edit-btn"
                            (click)="$event.stopPropagation()">
                            {{ action.icon }}
                        </a>
                    </div>
                </div>
            </div>

            <!-- Children Recursion -->
            <div class="node-children" *ngIf="node.expanded && node.children.length > 0">
                <ng-container *ngTemplateOutlet="treeNode; context: { $implicit: node.children }"></ng-container>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #loading>
    <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'ADMIN.COMMON.LOADING' | translate }}</p>
    </div>
</ng-template>