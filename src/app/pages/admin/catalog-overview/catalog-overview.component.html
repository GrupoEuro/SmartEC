<div class="cosmos-layout">
    <app-admin-page-header iconName="share-2" [title]="'ADMIN.CATALOG_OVERVIEW.TITLE' | translate"
        [subtitle]="'ADMIN.CATALOG_OVERVIEW.SUBTITLE' | translate">
    </app-admin-page-header>

    <div class="cosmos-viewport">
        @if (catalogData$ | async; as nodes) {
        @if (nodes.length > 0) {
        <div class="cosmos-tree">
            <ng-container *ngTemplateOutlet="nodeTemplate; context: { $implicit: nodes }"></ng-container>
        </div>
        } @else {
        <div class="empty-cosmos">
            <app-icon name="loader" class="spin" [size]="48"></app-icon>
            <p>Initializing Neural Network...</p>
        </div>
        }
        } @else {
        <div class="empty-cosmos">
            <app-icon name="loader" class="spin" [size]="48"></app-icon>
            <p>Connecting to Database...</p>
        </div>
        }
    </div>
</div>

<!-- Recursive Node Template -->
<ng-template #nodeTemplate let-nodes>
    <div class="node-group">
        @for (node of nodes; track node.id) {
        <div class="node-wrapper" [class.expanded]="node.expanded" [attr.data-level]="node.level"
            [attr.data-type]="node.type">

            <!-- The Node Itself -->
            <div class="cosmos-node" (click)="toggleNode(node)">

                <!-- Connector Line (Visual) -->
                <div class="connector-line"></div>

                <!-- Content -->
                <div class="node-content">
                    <div class="icon-placard" [class.glowing]="node.expanded">
                        <app-icon [name]="node.iconName" [size]="18"></app-icon>
                    </div>

                    <div class="node-details">
                        <span class="node-name">{{ node.name }}</span>
                        <span class="node-count">{{ node.count | number }} items</span>
                    </div>

                    @if (node.children.length > 0) {
                    <div class="node-chevron">
                        <app-icon name="chevron-right" [size]="16" [class.rotated]="node.expanded"></app-icon>
                    </div>
                    }
                </div>

                <!-- Actions (Hover Only) -->
                <div class="node-actions">
                    <!-- Contextual actions based on type can go here -->
                    <app-icon name="more-horizontal" [size]="16"></app-icon>
                </div>
            </div>

            <!-- Children Container -->
            @if (node.expanded && node.children.length > 0) {
            <div class="node-children">
                <ng-container *ngTemplateOutlet="nodeTemplate; context: { $implicit: node.children }"></ng-container>
            </div>
            }
        </div>
        }
    </div>
</ng-template>