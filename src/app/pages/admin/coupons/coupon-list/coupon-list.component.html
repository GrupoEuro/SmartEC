<div class="product-dashboard-layout">
    <!-- Sticky Command Header -->
    <header class="command-header">
        <div class="header-left">
            <h1 class="page-title">{{ 'ADMIN.COUPONS.TITLE' | translate }}</h1>
            <span class="product-count" *ngIf="paginatedCoupons.length || filteredCoupons.length">
                {{ filteredCoupons.length }} Coupons
            </span>
        </div>

        <div class="header-center">
            <div class="search-command-bar">
                <span class="search-icon">üîç</span>
                <input type="text" [formControl]="searchControl"
                    [placeholder]="'ADMIN.COUPONS.SEARCH_PLACEHOLDER' | translate">
            </div>
        </div>

        <div class="header-right">
            <button class="btn-primary-action" routerLink="/admin/coupons/new">
                <span class="icon">‚ûï</span>
                <span class="text">{{ 'ADMIN.COUPONS.ADD_NEW' | translate }}</span>
            </button>
        </div>
    </header>

    <div class="dashboard-content">
        <!-- Smart Filter Sidebar -->
        <aside class="filter-sidebar">
            <div class="sidebar-header">
                <h3>Filters</h3>
                <button class="btn-text-tiny"
                    (click)="searchControl.reset(); statusFilter.setValue('all'); typeFilter.setValue('all')">
                    Reset
                </button>
            </div>

            <!-- Status Filter -->
            <details class="filter-group" open>
                <summary>
                    <span>Status</span>
                    <span class="chevron">‚ñº</span>
                </summary>
                <div class="filter-options">
                    <label class="radio-option">
                        <input type="radio" [formControl]="statusFilter" value="all">
                        <span>All</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" [formControl]="statusFilter" value="active">
                        <span>Active</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" [formControl]="statusFilter" value="inactive">
                        <span>Inactive</span>
                    </label>
                </div>
            </details>

            <!-- Type Filter -->
            <details class="filter-group" open>
                <summary>
                    <span>Discount Type</span>
                    <span class="chevron">‚ñº</span>
                </summary>
                <div class="filter-options">
                    <label class="radio-option">
                        <input type="radio" [formControl]="typeFilter" value="all">
                        <span>All Types</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" [formControl]="typeFilter" value="percentage">
                        <span>Percentage (%)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" [formControl]="typeFilter" value="fixed_amount">
                        <span>Fixed Amount ($)</span>
                    </label>
                </div>
            </details>
        </aside>

        <!-- Main Grid Area -->
        <main class="product-grid-view">
            <div class="table-glass-container">
                <table class="rich-table">
                    <thead>
                        <tr>
                            <th (click)="sort('code')" class="sortable">
                                {{ 'ADMIN.COUPONS.TABLE.CODE' | translate }}
                            </th>
                            <th (click)="sort('value')" class="sortable text-right">
                                {{ 'ADMIN.COUPONS.TABLE.DISCOUNT' | translate }}
                            </th>
                            <th (click)="sort('usageLimit')" class="sortable text-right">
                                {{ 'ADMIN.COUPONS.TABLE.USAGE' | translate }}
                            </th>
                            <th (click)="sort('isActive')" class="sortable">
                                {{ 'ADMIN.COUPONS.TABLE.STATUS' | translate }}
                            </th>
                            <th (click)="sort('startDate')" class="sortable">
                                {{ 'ADMIN.COUPONS.TABLE.VALIDITY' | translate }}
                            </th>
                            <th>{{ 'ADMIN.COMMON.ACTIONS' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let coupon of paginatedCoupons" [class.expired-row]="isExpired(coupon)">
                            <td>
                                <div class="product-identity">
                                    <span class="product-name code-font"
                                        [routerLink]="['/admin/coupons/edit', coupon.id]">
                                        {{ coupon.code }}
                                    </span>
                                    <span class="expired-tag" *ngIf="isExpired(coupon)">EXPIRED</span>
                                </div>
                            </td>
                            <td class="text-right">
                                <span class="discount-pill" [class.fixed]="coupon.type === 'fixed_amount'">
                                    {{ coupon.type === 'percentage' ? (coupon.value + '%') : (coupon.value | currency)
                                    }}
                                </span>
                            </td>
                            <td>
                                <div class="usage-progress-wrapper">
                                    <div class="progress-bar-tiny">
                                        <div class="fill"
                                            [style.width.%]="(coupon.usageCount / (coupon.usageLimit || 1)) * 100"
                                            [class.full]="coupon.usageLimit > 0 && coupon.usageCount >= coupon.usageLimit">
                                        </div>
                                    </div>
                                    <span class="usage-text">{{ coupon.usageCount }} / {{ coupon.usageLimit === 0 ? '‚àû'
                                        : coupon.usageLimit }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="stock-pill" [class.success]="coupon.isActive"
                                    [class.danger]="!coupon.isActive">
                                    <span class="dot"></span>
                                    <span class="status-text">{{ coupon.isActive ? 'Active' : 'Inactive' }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="date-range-compact">
                                    <span>{{ $any(coupon.startDate) | date:'MMM d' }}</span>
                                    <span class="arrow">‚Üí</span>
                                    <span *ngIf="coupon.endDate">{{ $any(coupon.endDate) | date:'MMM d, y' }}</span>
                                    <span *ngIf="!coupon.endDate">‚àû</span>
                                </div>
                            </td>
                            <td>
                                <div class="row-actions">
                                    <button class="btn-icon-ghost" [routerLink]="['/admin/coupons/edit', coupon.id]"
                                        [title]="'ADMIN.COMMON.EDIT' | translate">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn-icon-ghost danger" (click)="deleteCoupon(coupon)"
                                        [title]="'ADMIN.COMMON.DELETE' | translate">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <tr *ngIf="!isLoading && filteredCoupons.length === 0">
                            <td colspan="6" class="no-data">
                                <div class="empty-state-content">
                                    <span class="empty-icon">üéüÔ∏è</span>
                                    <p>{{ 'ADMIN.COUPONS.EMPTY_MSG' | translate }}</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-wrapper" *ngIf="filteredCoupons.length > 0">
                <app-pagination
                    [config]="{ currentPage: currentPage, itemsPerPage: pageSize, totalItems: filteredCoupons.length }"
                    (pageChange)="onPageChange($event)" (itemsPerPageChange)="pageSize = $event; currentPage = 1;">
                </app-pagination>
            </div>
        </main>
    </div>
</div>