<div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>{{ 'ADMIN.COMMON.LOADING' | translate }}</p>
</div>

<div *ngIf="!isLoading && customer" class="detail-container">
    <app-admin-page-header icon="ðŸ‘¤" [title]="customer.displayName || customer.email"
        [subtitle]="'ADMIN.CUSTOMERS.DETAIL.SUBTITLE' | translate">
    </app-admin-page-header>

    <div class="detail-grid">
        <!-- Sidebar -->
        <div class="side-col">
            <!-- Profile Card -->
            <div class="card profile-card">
                <div class="profile-header">
                    <div class="avatar-lg" *ngIf="!customer.photoURL">
                        {{ customer.displayName?.charAt(0) || customer.email.charAt(0) | uppercase }}
                    </div>
                    <img *ngIf="customer.photoURL" [src]="customer.photoURL" class="avatar-lg-img">
                    <h3>{{ customer.displayName || 'Guest' }}</h3>
                    <span class="role-badge">{{ customer.role }}</span>
                </div>

                <div class="info-list">
                    <div class="info-item">
                        <span class="label">{{ 'ADMIN.CUSTOMERS.TABLE.EMAIL' | translate }}</span>
                        <span class="value">{{ customer.email }}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">{{ 'ADMIN.CUSTOMERS.TABLE.JOINED' | translate }}</span>
                        <span class="value">{{ customer.createdAt | date:'mediumDate' }}</span>
                    </div>
                    <div class="info-item" *ngIf="customer.phone">
                        <span class="label">Phone</span>
                        <span class="value">{{ customer.phone }}</span>
                    </div>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="card stats-card">
                <h3>{{ 'ADMIN.CUSTOMERS.DETAIL.STATS' | translate }}</h3>
                <div class="stat-row">
                    <span class="stat-label">{{ 'ADMIN.CUSTOMERS.TABLE.ORDERS' | translate }}</span>
                    <span class="stat-value">{{ customerOrders.length }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">{{ 'ADMIN.CUSTOMERS.TABLE.SPEND' | translate }}</span>
                    <span class="stat-value text-success font-bold">
                        {{ (customer.stats?.totalSpend || 0) | currency }}
                    </span>
                </div>
            </div>

            <!-- Shipping Address Card -->
            <div class="card address-card" *ngIf="customer.shippingAddress">
                <h3>Shipping Address</h3>
                <div class="address-content">
                    <p class="address-line">{{ customer.shippingAddress.street }} {{
                        customer.shippingAddress.exteriorNumber }}</p>
                    <p class="address-line" *ngIf="customer.shippingAddress.interiorNumber">
                        Int. {{ customer.shippingAddress.interiorNumber }}
                    </p>
                    <p class="address-line">
                        {{ customer.shippingAddress.neighborhood ? customer.shippingAddress.neighborhood + ',' : '' }}
                        {{ customer.shippingAddress.city }}
                    </p>
                    <p class="address-line">{{ customer.shippingAddress.state }}, {{ customer.shippingAddress.country }}
                    </p>
                    <p class="address-line postal-code">{{ customer.shippingAddress.zipCode }}</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-col">
            <!-- Order History -->
            <div class="card orders-card">
                <h3>{{ 'ADMIN.CUSTOMERS.DETAIL.ORDER_HISTORY' | translate }}</h3>

                <table class="admin-table" *ngIf="customerOrders.length > 0">
                    <thead>
                        <tr>
                            <th>{{ 'ADMIN.ORDERS.TABLE.ORDER_NUMBER' | translate }}</th>
                            <th>{{ 'ADMIN.ORDERS.TABLE.DATE' | translate }}</th>
                            <th>{{ 'ADMIN.ORDERS.TABLE.STATUS' | translate }}</th>
                            <th class="text-right">{{ 'ADMIN.ORDERS.TABLE.TOTAL' | translate }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let order of customerOrders">
                            <td class="font-mono">#{{ order.orderNumber }}</td>
                            <td>{{ $any(order.createdAt) | date:'shortDate' }}</td>
                            <td>
                                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                                    {{ 'ADMIN.ORDERS.STATUS.' + order.status.toUpperCase() | translate }}
                                </span>
                            </td>
                            <td class="text-right font-bold">{{ order.total | currency }}</td>
                            <td class="text-right">
                                <a [routerLink]="['/admin/orders', order.id]" class="btn-sm">
                                    View
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="empty-orders" *ngIf="customerOrders.length === 0">
                    <p>{{ 'ADMIN.CUSTOMERS.DETAIL.NO_ORDERS' | translate }}</p>
                </div>
            </div>
        </div>
    </div>
</div>