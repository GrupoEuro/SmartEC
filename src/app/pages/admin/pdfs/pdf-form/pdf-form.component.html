<app-admin-page-header [iconName]="isEditing ? 'edit' : 'plus'" [title]="isEditing ? 'Edit PDF' : 'Add New PDF'"
    [showSaveCancel]="true" [hasUnsavedChanges]="pdfForm.dirty" [isFormInvalid]="pdfForm.invalid" (onSave)="onSubmit()"
    (onCancel)="onCancel()">
</app-admin-page-header>

<div class="form-container">
    <form [formGroup]="pdfForm" (ngSubmit)="onSubmit()">
        <!-- Title Section -->
        <div class="form-section">
            <h2 class="section-title">üìù Title (Multilingual)</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="title_es">Title (Spanish) <span class="required">*</span></label>
                    <input type="text" id="title_es" formControlName="title_es" class="form-control"
                        placeholder="T√≠tulo en espa√±ol">
                </div>
                <div class="form-group">
                    <label for="title_en">Title (English) <span class="required">*</span></label>
                    <input type="text" id="title_en" formControlName="title_en" class="form-control"
                        placeholder="Title in English">
                </div>
            </div>
        </div>

        <!-- Description Section -->
        <div class="form-section">
            <h2 class="section-title">üìÑ Description (Multilingual)</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="description_es">Description (Spanish) <span class="required">*</span></label>
                    <textarea id="description_es" formControlName="description_es" class="form-control" rows="3"
                        placeholder="Descripci√≥n en espa√±ol"></textarea>
                </div>
                <div class="form-group">
                    <label for="description_en">Description (English) <span class="required">*</span></label>
                    <textarea id="description_en" formControlName="description_en" class="form-control" rows="3"
                        placeholder="Description in English"></textarea>
                </div>
            </div>
        </div>

        <!-- Category and Tags -->
        <div class="form-section">
            <h2 class="section-title">üè∑Ô∏è Category & Tags</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="category">Category <span class="required">*</span></label>
                    <select id="category" formControlName="category" class="form-control">
                        <option *ngFor="let cat of categories" [value]="cat.value">{{ cat.label }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tags">Tags (comma separated)</label>
                    <input type="text" id="tags" formControlName="tags" class="form-control"
                        placeholder="tire, praxis, catalog">
                </div>
            </div>
        </div>

        <!-- Access Control -->
        <div class="form-section">
            <h2 class="section-title">üîê Access Control</h2>
            <div class="toggle-switches-group">
                <div class="form-group">
                    <app-toggle-switch [control]="$any(pdfForm.get('isPublic'))" label="üåê Public (Free Download)"
                        icon="üåê" hint="Anyone can download without login">
                    </app-toggle-switch>
                </div>
                <div class="form-group">
                    <app-toggle-switch [control]="$any(pdfForm.get('requiresAuth'))" label="üîí Requires Login" icon="üîí"
                        hint="User must be logged in to download">
                    </app-toggle-switch>
                </div>
            </div>
        </div>

        <!-- File Upload -->
        <div class="form-section">
            <h2 class="section-title">üìé PDF File</h2>
            <div class="form-group">
                <div class="upload-area" (click)="pdfFileInput.click()">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-label">
                        <strong>{{ selectedPdfFile ? selectedPdfFile.name : 'Click to upload PDF' }}</strong>
                        <span class="file-hint">{{ isEditing ? 'Leave empty to keep current file' : 'Required' }}</span>
                    </div>
                </div>
                <input #pdfFileInput type="file" id="pdfFile" accept=".pdf" (change)="onPdfFileSelected($event)"
                    class="file-input">

                @if (isEditing && currentPdf && !selectedPdfFile) {
                <div class="current-file-info">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <span class="file-name">{{ currentPdf.fileName }}</span>
                        <span class="file-meta">{{ formatFileSize(currentPdf.fileSize) }} ‚Ä¢ <a
                                [href]="currentPdf.fileUrl" target="_blank" class="view-link">View File</a></span>
                    </div>
                </div>
                }
                @if (selectedPdfFile) {
                <div class="current-file-info new-file">
                    <div class="file-icon">üÜï</div>
                    <div class="file-details">
                        <span class="file-name">{{ selectedPdfFile.name }}</span>
                        <span class="file-meta">{{ formatFileSize(selectedPdfFile.size) }}</span>
                    </div>
                </div>
                }

                @if (isProcessing) {
                <div class="processing-indicator">
                    <app-icon name="loader" [size]="16" class="animate-spin"></app-icon>
                    <span>Analyzing PDF... generating thumbnail & extracting text</span>
                </div>
                }
            </div>
        </div>

        <!-- Thumbnail Upload -->
        <div class="form-section">
            <h2 class="section-title">üñºÔ∏è Thumbnail (Optional)</h2>
            <div class="form-group">
                <div class="upload-area" (click)="thumbInput.click()">
                    <div class="upload-icon">üñºÔ∏è</div>
                    <div class="upload-label">
                        <strong>{{ selectedThumbnailFile ? selectedThumbnailFile.name : 'Click to upload thumbnail'
                            }}</strong>
                        <span class="file-hint">Optional - Recommended size: 400x300px</span>
                    </div>
                </div>
                <input #thumbInput type="file" id="thumbnail" accept="image/*" (change)="onThumbnailSelected($event)"
                    class="file-input">

                @if (thumbnailPreviewUrl) {
                <div class="thumbnail-preview mt-4">
                    <img [src]="thumbnailPreviewUrl" alt="Thumbnail preview">
                </div>
                }
            </div>
        </div>
    </form>
</div>