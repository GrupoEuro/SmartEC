<div class="h-full flex flex-col bg-zinc-950 text-white" *ngIf="cycleCount() as count">

    <!-- Header -->
    <header class="bg-zinc-900/50 backdrop-blur-sm border-b border-zinc-800 p-6 sticky top-0 z-20">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
                <button routerLink="/operations/cycle-counting"
                    class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-zinc-800 text-zinc-400 transition-colors">
                    <app-icon name="arrow-left" [size]="20"></app-icon>
                </button>
                <div>
                    <div class="flex items-center gap-3">
                        <h1 class="text-xl font-bold tracking-tight">{{ count.notes }}</h1>
                        <span
                            class="px-2 py-0.5 rounded text-xs font-bold bg-amber-900/30 text-amber-400 border border-amber-500/20">
                            {{ count.status }}
                        </span>
                    </div>
                    <div class="flex items-center gap-4 mt-1 text-xs text-zinc-400">
                        <span class="flex items-center gap-1">
                            <app-icon name="calendar" [size]="12"></app-icon>
                            Due: {{ count.scheduledDate.toDate() | date:'mediumDate' }}
                        </span>
                        <span class="flex items-center gap-1">
                            <app-icon name="map-pin" [size]="12"></app-icon>
                            {{ count.type }} Count
                        </span>
                        <span class="flex items-center gap-1">
                            <app-icon name="user" [size]="12"></app-icon>
                            Assigned to: You
                        </span>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button
                    class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg text-sm font-medium transition-colors border border-zinc-700">
                    Save Draft
                </button>
                <button (click)="completeCount()" [disabled]="progress() < 100"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-all shadow-lg shadow-blue-900/20 flex items-center gap-2">
                    <app-icon name="check-circle" [size]="18"></app-icon>
                    Complete Count
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="flex items-center gap-4">
            <div class="flex-1 h-3 bg-zinc-800 rounded-full overflow-hidden">
                <div class="h-full bg-blue-500 transition-all duration-500" [style.width.%]="progress()"></div>
            </div>
            <span class="text-sm font-bold text-blue-400 min-w-[3rem]">{{ itemsCounted() }} / {{ count.items.length
                }}</span>
        </div>
    </header>

    <!-- Count List -->
    <div class="flex-1 overflow-y-auto p-6">
        <div class="bg-zinc-900 rounded-xl border border-zinc-800 overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-zinc-900/50 text-xs uppercase text-zinc-500 border-b border-zinc-800">
                        <th class="p-4 font-medium w-20">Loc</th>
                        <th class="p-4 font-medium">Product / SKU</th>
                        <th class="p-4 font-medium text-right w-32">Expected</th>
                        <th class="p-4 font-medium w-40">Counted</th>
                        <th class="p-4 font-medium text-right w-32">Variance</th>
                        <th class="p-4 font-medium text-center w-28">Status</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-zinc-800">
                    <tr *ngFor="let item of count.items" class="hover:bg-zinc-800/30 transition-colors group"
                        [ngClass]="{'bg-blue-900/5': item.status === 'COUNTED', 'bg-red-900/5': item.variance !== 0 && item.status === 'COUNTED'}">

                        <!-- Location -->
                        <td class="p-4">
                            <span class="font-mono text-zinc-400 text-sm">{{ item.location || 'N/A' }}</span>
                        </td>

                        <!-- Product -->
                        <td class="p-4">
                            <div class="font-medium text-white">{{ item.productName }}</div>
                            <div class="text-xs text-zinc-500">{{ item.sku }}</div>
                        </td>

                        <!-- Expected -->
                        <td class="p-4 text-right">
                            <span class="text-zinc-400 font-mono">{{ item.expectedQuantity }}</span>
                        </td>

                        <!-- Counted Input -->
                        <td class="p-4">
                            <div class="relative">
                                <input type="number" [ngModel]="item.countedQuantity"
                                    (ngModelChange)="updateQuantity(item, $event)"
                                    class="w-full bg-black/20 border border-zinc-700 rounded-lg px-3 py-2 text-white font-mono focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 transition-all placeholder-zinc-700"
                                    placeholder="Qty">
                            </div>
                        </td>

                        <!-- Variance -->
                        <td class="p-4 text-right">
                            <span *ngIf="item.status === 'COUNTED'" class="font-mono font-bold" [ngClass]="{
                                      'text-emerald-400': item.variance === 0,
                                      'text-red-400': item.variance !== 0
                                  }">
                                {{ item.variance > 0 ? '+' : '' }}{{ item.variance }}
                            </span>
                            <span *ngIf="item.status === 'PENDING'" class="text-zinc-700">-</span>
                        </td>

                        <!-- Status -->
                        <td class="p-4 text-center">
                            <span class="px-2 py-1 rounded text-[10px] font-bold border uppercase tracking-wider"
                                [ngClass]="getStatusColor(item.status)">
                                {{ item.status }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>