<div class="h-full flex flex-col bg-zinc-950 text-white overflow-hidden">
    <!-- Header -->
    <header class="bg-zinc-900/50 backdrop-blur-sm border-b border-zinc-800 p-6 sticky top-0 z-20">
        <div class="max-w-7xl mx-auto w-full">
            <!-- Breadcrumb -->
            <div class="flex items-center gap-2 text-xs text-zinc-500 mb-4">
                <a routerLink="/operations/inventory" class="hover:text-blue-400 transition-colors">Inventory</a>
                <app-icon name="chevron-right" [size]="12"></app-icon>
                <span class="text-zinc-300">Kardex History</span>
            </div>

            <div class="flex items-start justify-between">
                <div class="flex items-center gap-6" *ngIf="product() as p">
                    <!-- Product Image -->
                    <div
                        class="w-16 h-16 bg-white rounded-lg p-1 flex items-center justify-center shadow-lg shadow-black/50">
                        <img *ngIf="p.images?.[0]" [src]="p.images[0]" class="max-w-full max-h-full object-contain">
                        <app-icon *ngIf="!p.images?.[0]" name="box" [size]="32" class="text-zinc-400"></app-icon>
                    </div>

                    <!-- Details -->
                    <div>
                        <div class="flex items-center gap-3">
                            <h1 class="text-2xl font-bold tracking-tight text-white">{{ p.name }}</h1>
                            <span
                                class="bg-zinc-800 text-zinc-400 px-2 py-0.5 rounded text-xs font-mono border border-zinc-700">
                                {{ p.sku }}
                            </span>
                        </div>
                        <div class="flex items-center gap-6 mt-2 text-sm text-zinc-400">
                            <span class="flex items-center gap-2">
                                <app-icon name="tag" [size]="16"></app-icon>
                                {{ p.brand }} / {{ p.category }}
                            </span>
                            <span class="flex items-center gap-2 text-zinc-500">
                                <app-icon name="map-pin" [size]="16"></app-icon>
                                Main Warehouse
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Stats Summary -->
                <div class="flex items-center gap-6" *ngIf="product() as p">
                    <div class="text-right">
                        <div class="text-xs text-zinc-500 uppercase tracking-widest font-bold mb-1">Current Stock</div>
                        <div class="text-3xl font-bold font-mono text-blue-400">{{ currentStock() }}</div>
                    </div>
                    <div class="h-10 w-px bg-zinc-800"></div>
                    <div class="text-right">
                        <div class="text-xs text-zinc-500 uppercase tracking-widest font-bold mb-1">Avg Cost</div>
                        <div class="text-xl font-bold font-mono text-zinc-300">{{ formatCurrency(p.averageCost || 0) }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls Bar -->
            <div class="mt-8 flex items-center justify-between">
                <!-- Date Filter Tabs -->
                <div class="flex bg-zinc-900 p-1 rounded-lg border border-zinc-800">
                    <button class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
                        [class.bg-zinc-700]="dateRange() === '7d'" [class.text-white]="dateRange() === '7d'"
                        [class.text-zinc-400]="dateRange() !== '7d'" (click)="dateRange.set('7d')">7 Days</button>
                    <button class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
                        [class.bg-zinc-700]="dateRange() === '30d'" [class.text-white]="dateRange() === '30d'"
                        [class.text-zinc-400]="dateRange() !== '30d'" (click)="dateRange.set('30d')">30 Days</button>
                    <button class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
                        [class.bg-zinc-700]="dateRange() === '90d'" [class.text-white]="dateRange() === '90d'"
                        [class.text-zinc-400]="dateRange() !== '90d'" (click)="dateRange.set('90d')">3 Months</button>
                    <button class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
                        [class.bg-zinc-700]="dateRange() === 'all'" [class.text-white]="dateRange() === 'all'"
                        [class.text-zinc-400]="dateRange() !== 'all'" (click)="dateRange.set('all')">All Time</button>
                </div>

                <button
                    class="flex items-center gap-2 px-4 py-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition-colors text-sm font-medium">
                    <app-icon name="download" [size]="16"></app-icon>
                    Export CSV
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 overflow-y-auto bg-zinc-950">
        <div class="max-w-7xl mx-auto p-6 space-y-6">

            <!-- Chart Section -->
            <div class="bg-zinc-900 rounded-xl border border-zinc-800 p-6 h-80 relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-br from-blue-900/5 to-transparent pointer-events-none">
                </div>
                <h3 class="text-sm font-bold text-zinc-400 mb-4 flex items-center gap-2 relative z-10">
                    <app-icon name="trending-up" [size]="16"></app-icon> Stock Trend
                </h3>

                <!-- Chart Component -->
                <app-stock-trend-chart *ngIf="product()" [productId]="product()!.id" [dateRange]="dateRange()">
                </app-stock-trend-chart>
            </div>

            <!-- Table Section -->
            <div class="bg-zinc-900 rounded-xl border border-zinc-800 overflow-hidden shadow-xl">
                <div class="px-6 py-4 border-b border-zinc-800 flex justify-between items-center">
                    <h3 class="text-sm font-bold text-zinc-400 flex items-center gap-2">
                        <app-icon name="list" [size]="16"></app-icon> Transaction History
                    </h3>

                    <!-- Search/Filters for Table -->
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <app-icon name="search" [size]="14"
                                class="absolute left-3 top-2.5 text-zinc-500"></app-icon>
                            <input type="text" placeholder="Search ref or notes..."
                                class="bg-zinc-950 border border-zinc-700 rounded-lg pl-9 pr-3 py-1.5 text-sm text-white focus:border-blue-500 focus:outline-none w-64 placeholder-zinc-600">
                        </div>
                    </div>
                </div>

                <!-- Table Component -->
                <app-kardex-history-table *ngIf="product()" [productId]="product()!.id" [dateRange]="dateRange()">
                </app-kardex-history-table>
            </div>

        </div>
    </div>
</div>