<div class="operations-layout theme-ops">
    <aside class="sidebar bg-zinc-900 border-r border-zinc-800" [class.collapsed]="isSidebarCollapsed()">
        <!-- Sidebar Header -->
        <div class="sidebar-header">
            <div class="header-content">
                <h3>{{ 'OPERATIONS.TITLE' | translate }}</h3>
                <button class="toggle-btn" (click)="toggleSidebar()">
                    <app-icon [name]="isSidebarCollapsed() ? 'menu' : 'arrow-left'" [size]="20"></app-icon>
                </button>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-6 custom-scrollbar">

            <!-- DASHBOARD (Always Visible) -->
            <div class="nav-group mb-2">
                <a routerLink="/operations/dashboard" routerLinkActive="active-nav-item"
                    class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden"
                    [title]="isSidebarCollapsed() ? 'Overview' : ''">
                    <app-icon name="layout-dashboard" [size]="20"
                        class="group-hover:text-blue-400 transition-colors relative z-10"></app-icon>
                    <span class="font-medium text-sm whitespace-nowrap relative z-10"
                        [class.hidden]="isSidebarCollapsed()">{{ 'OPERATIONS.DASHBOARD.TITLE' | translate }}</span>
                </a>
            </div>

            <!-- ORDER FULFILLMENT -->
            <div class="nav-section">
                <button
                    class="section-header w-full flex items-center justify-between px-3 py-2 text-xs font-bold text-zinc-500 uppercase tracking-wider hover:text-zinc-300 transition-colors"
                    (click)="toggleSection('fulfillment')" [class.collapsed]="!sections.fulfillment"
                    [title]="isSidebarCollapsed() ? 'Order Fulfillment' : ''">
                    <span [class.hidden]="isSidebarCollapsed()">ORDER FULFILLMENT</span>
                    <app-icon [name]="sections.fulfillment ? 'chevron-down' : 'chevron-right'" [size]="14"
                        class="toggle-icon" [class.hidden]="isSidebarCollapsed()"></app-icon>
                    <app-icon name="shopping-bag" [size]="20" class="section-icon"
                        *ngIf="isSidebarCollapsed()"></app-icon>
                </button>

                <div class="section-items overflow-hidden transition-all duration-300 ease-in-out"
                    [class.expanded]="sections.fulfillment" [style.height]="sections.fulfillment ? 'auto' : '0'"
                    [class.opacity-0]="!sections.fulfillment" [class.opacity-100]="sections.fulfillment"
                    [class.hidden]="isSidebarCollapsed() && !sections.fulfillment">
                    <a routerLink="/operations/orders" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Order Queue' : ''">
                        <app-icon name="shopping-bag" [size]="18"
                            class="group-hover:text-blue-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Order Queue</span>
                        <span
                            class="ml-auto bg-blue-600/20 text-blue-400 text-xs font-bold px-2 py-0.5 rounded-full relative z-10"
                            *ngIf="!isSidebarCollapsed()">12</span>
                    </a>
                </div>
            </div>

            <!-- INVENTORY & LOGISTICS -->
            <div class="nav-section">
                <button
                    class="section-header w-full flex items-center justify-between px-3 py-2 text-xs font-bold text-zinc-500 uppercase tracking-wider hover:text-zinc-300 transition-colors"
                    (click)="toggleSection('inventory')" [class.collapsed]="!sections.inventory"
                    [title]="isSidebarCollapsed() ? 'Inventory & Logistics' : ''">
                    <span [class.hidden]="isSidebarCollapsed()">INVENTORY & LOGISTICS</span>
                    <app-icon [name]="sections.inventory ? 'chevron-down' : 'chevron-right'" [size]="14"
                        class="toggle-icon" [class.hidden]="isSidebarCollapsed()"></app-icon>
                    <app-icon name="box" [size]="20" class="section-icon" *ngIf="isSidebarCollapsed()"></app-icon>
                </button>

                <div class="section-items overflow-hidden transition-all duration-300 ease-in-out"
                    [class.expanded]="sections.inventory" [style.height]="sections.inventory ? 'auto' : '0'"
                    [class.opacity-0]="!sections.inventory" [class.opacity-100]="sections.inventory"
                    [class.hidden]="isSidebarCollapsed() && !sections.inventory">
                    <a routerLink="/operations/inventory" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Inventory Lookup' : ''">
                        <app-icon name="search" [size]="18"
                            class="group-hover:text-emerald-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Inventory Lookup</span>
                    </a>
                    <a routerLink="/operations/cycle-counting" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Cycle Counting' : ''">
                        <app-icon name="refresh-cw" [size]="18"
                            class="group-hover:text-emerald-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Cycle Counting</span>
                    </a>
                    <a routerLink="/operations/abc-analysis" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'ABC Analysis' : ''">
                        <app-icon name="bar-chart-2" [size]="18"
                            class="group-hover:text-emerald-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">ABC Analysis</span>
                    </a>
                    <a routerLink="/operations/warehouses" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Warehouses' : ''">
                        <app-icon name="layers" [size]="18"
                            class="group-hover:text-emerald-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Warehouses</span>
                    </a>
                </div>
            </div>

            <!-- COMMERCIAL -->
            <div class="nav-section">
                <button
                    class="section-header w-full flex items-center justify-between px-3 py-2 text-xs font-bold text-zinc-500 uppercase tracking-wider hover:text-zinc-300 transition-colors"
                    (click)="toggleSection('customers')" [class.collapsed]="!sections.customers"
                    [title]="isSidebarCollapsed() ? 'Commercial' : ''">
                    <span [class.hidden]="isSidebarCollapsed()">COMMERCIAL</span>
                    <app-icon [name]="sections.customers ? 'chevron-down' : 'chevron-right'" [size]="14"
                        class="toggle-icon" [class.hidden]="isSidebarCollapsed()"></app-icon>
                    <app-icon name="users" [size]="20" class="section-icon" *ngIf="isSidebarCollapsed()"></app-icon>
                </button>

                <div class="section-items overflow-hidden transition-all duration-300 ease-in-out"
                    [class.expanded]="sections.customers" [style.height]="sections.customers ? 'auto' : '0'"
                    [class.opacity-0]="!sections.customers" [class.opacity-100]="sections.customers"
                    [class.hidden]="isSidebarCollapsed() && !sections.customers">
                    <a routerLink="/operations/customers" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Customers' : ''">
                        <app-icon name="users" [size]="18"
                            class="group-hover:text-purple-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Customers</span>
                    </a>
                    <a routerLink="/operations/promotions" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Promotions' : ''">
                        <app-icon name="tag" [size]="18"
                            class="group-hover:text-purple-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Promotions</span>
                    </a>
                </div>
            </div>

            <!-- PROCUREMENT -->
            <div class="nav-section">
                <button
                    class="section-header w-full flex items-center justify-between px-3 py-2 text-xs font-bold text-zinc-500 uppercase tracking-wider hover:text-zinc-300 transition-colors"
                    (click)="toggleSection('procurement')" [class.collapsed]="!sections.procurement"
                    [title]="isSidebarCollapsed() ? 'Procurement' : ''">
                    <span [class.hidden]="isSidebarCollapsed()">PROCUREMENT</span>
                    <app-icon [name]="sections.procurement ? 'chevron-down' : 'chevron-right'" [size]="14"
                        class="toggle-icon" [class.hidden]="isSidebarCollapsed()"></app-icon>
                    <app-icon name="truck" [size]="20" class="section-icon" *ngIf="isSidebarCollapsed()"></app-icon>
                </button>

                <div class="section-items overflow-hidden transition-all duration-300 ease-in-out"
                    [class.expanded]="sections.procurement" [style.height]="sections.procurement ? 'auto' : '0'"
                    [class.opacity-0]="!sections.procurement" [class.opacity-100]="sections.procurement"
                    [class.hidden]="isSidebarCollapsed() && !sections.procurement">
                    <a routerLink="/operations/procurement" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                        [title]="isSidebarCollapsed() ? 'Purchase Orders' : ''">
                        <app-icon name="truck" [size]="18"
                            class="group-hover:text-amber-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">Purchase Orders</span>
                    </a>
                </div>
            </div>

        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            @if (user$ | async; as user) {
            <div class="user-profile" [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                <div class="user-avatar">
                    @if (user.photoURL) {
                    <img [src]="user.photoURL" [alt]="(userProfile$ | async)?.displayName || user.displayName">
                    } @else {
                    <div class="avatar-placeholder">
                        <app-icon name="user" [size]="20"></app-icon>
                    </div>
                    }
                </div>
                <div class="user-info">
                    <span class="user-name">{{ (userProfile$ | async)?.displayName || user.displayName || 'User'
                        }}</span>
                    <span class="user-email">{{ user.email }}</span>
                </div>
            </div>
            }
            <button (click)="logout()" class="logout-btn" [title]="'OPERATIONS.LOGOUT' | translate">
                <span class="icon"><app-icon name="log-out" [size]="20"></app-icon></span>
                <span class="text">{{ 'OPERATIONS.LOGOUT' | translate }}</span>
            </button>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="operations-content bg-zinc-950" [class.expanded]="isSidebarCollapsed()">
        <header class="operations-header bg-zinc-800/80 backdrop-blur-md border-b border-zinc-700 text-white">
            <div class="spacer"></div>

            <div class="header-actions-group">
                <!-- Language Switcher -->
                <button (click)="toggleLanguage()"
                    class="flex items-center justify-center w-8 h-8 rounded-lg border border-zinc-700 bg-zinc-800 text-zinc-300 hover:bg-zinc-700 hover:text-white hover:border-zinc-600 transition-all font-bold text-xs shadow-sm"
                    [title]="'Switch Language' | translate">
                    {{ languageService.currentLang() === 'es' ? 'EN' : 'ES' }}
                </button>

                @if (user$ | async; as user) {
                <div class="user-menu-container">
                    <button class="header-avatar" (click)="toggleUserMenu()"
                        [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                        @if (user.photoURL) {
                        <img [src]="user.photoURL"
                            [alt]="(userProfile$ | async)?.displayName || user.displayName || 'User'">
                        } @else {
                        <div class="avatar-placeholder-sm">
                            <app-icon name="user" [size]="16"></app-icon>
                        </div>
                        }
                    </button>

                    @if (isUserMenuOpen) {
                    <div class="user-dropdown bg-zinc-800 border border-zinc-700 shadow-xl text-white">
                        <div class="dropdown-header border-b border-zinc-700">
                            <span class="d-name text-white">{{ (userProfile$ | async)?.displayName || user.displayName
                                || 'User'
                                }}</span>
                            @if (userProfile$ | async; as profile) {
                            <span class="d-role-badge bg-emerald-900/30 text-emerald-400">{{ profile.role }}</span>
                            }
                            <span class="d-email text-zinc-400">{{ user.email }}</span>
                        </div>
                        <div class="dropdown-divider bg-zinc-700"></div>
                        <a routerLink="/" class="dropdown-item hover:bg-zinc-700 text-zinc-300 hover:text-white">
                            <span class="icon"><app-icon name="home" [size]="16"></app-icon></span>
                            {{ 'OPERATIONS.GO_HOME' | translate }}
                        </a>
                        <button (click)="logout()" class="dropdown-item hover:bg-red-900/20 text-red-400">
                            <span class="icon"><app-icon name="log-out" [size]="16"></app-icon></span>
                            {{ 'OPERATIONS.LOGOUT' | translate }}
                        </button>
                    </div>
                    }
                </div>
                }
            </div>
        </header>

        <div class="content-wrapper">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>