<div class="operations-layout theme-ops">
    <aside class="sidebar bg-zinc-900 border-r border-zinc-800" [class.collapsed]="isSidebarCollapsed()">
        <!-- Sidebar Header -->
        <div class="sidebar-header">
            <div class="header-content">
                <h3>{{ 'OPERATIONS.TITLE' | translate }}</h3>
                <button class="toggle-btn" (click)="toggleSidebar()">
                    <app-icon [name]="isSidebarCollapsed() ? 'menu' : 'arrow-left'" [size]="20"></app-icon>
                </button>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-6 custom-scrollbar">

            <!-- Dynamic Navigation Loop -->
            <ng-container *ngFor="let item of navigationItems">

                <!-- Single Item (No Children) -->
                <div *ngIf="!item.children" class="nav-group mb-2">
                    <a [routerLink]="item.route" routerLinkActive="active-nav-item"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden"
                        [title]="isSidebarCollapsed() ? (item.title | translate) : ''">
                        <app-icon [name]="item.icon" [size]="20"
                            class="group-hover:text-blue-400 transition-colors relative z-10"></app-icon>
                        <span class="font-medium text-sm whitespace-nowrap relative z-10"
                            [class.hidden]="isSidebarCollapsed()">{{ item.title | translate }}</span>

                        <!-- Badge -->
                        <span *ngIf="item.badge && !isSidebarCollapsed()"
                            class="ml-auto text-[10px] font-bold px-1.5 py-0.5 rounded text-white"
                            [ngClass]="item.badge.color || 'bg-blue-600'">
                            {{ item.badge.text }}
                        </span>
                    </a>
                </div>

                <!-- Section with Children -->
                <div *ngIf="item.children" class="nav-section">
                    <button
                        class="section-header w-full flex items-center justify-between px-3 py-2 text-xs font-bold text-zinc-500 uppercase tracking-wider hover:text-zinc-300 transition-colors"
                        (click)="toggleSection(item.id)" [class.collapsed]="!isExpanded(item.id)"
                        [title]="isSidebarCollapsed() ? (item.title | translate) : ''">
                        <span [class.hidden]="isSidebarCollapsed()">{{ item.title | translate }}</span>
                        <app-icon [name]="isExpanded(item.id) ? 'chevron-down' : 'chevron-right'" [size]="14"
                            class="toggle-icon" [class.hidden]="isSidebarCollapsed()"></app-icon>
                        <app-icon [name]="item.icon" [size]="20" class="section-icon"
                            *ngIf="isSidebarCollapsed()"></app-icon>
                    </button>

                    <div class="section-items overflow-hidden transition-all duration-300 ease-in-out"
                        [class.expanded]="isExpanded(item.id)" [style.height]="isExpanded(item.id) ? 'auto' : '0'"
                        [class.opacity-0]="!isExpanded(item.id)" [class.opacity-100]="isExpanded(item.id)"
                        [class.hidden]="isSidebarCollapsed() && !isExpanded(item.id)">

                        <ng-container *ngFor="let child of item.children">
                            <a [routerLink]="child.route" routerLinkActive="active-nav-item"
                                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all group relative overflow-hidden ml-2"
                                [title]="isSidebarCollapsed() ? (child.title | translate) : ''">
                                <app-icon [name]="child.icon" [size]="18"
                                    class="group-hover:text-emerald-400 transition-colors relative z-10"></app-icon>
                                <span class="font-medium text-sm whitespace-nowrap relative z-10"
                                    [class.hidden]="isSidebarCollapsed()">{{ child.title | translate }}</span>

                                <!-- Child Badge -->
                                <span *ngIf="child.badge && !isSidebarCollapsed()"
                                    class="ml-auto text-[10px] font-bold px-1.5 py-0.5 rounded text-white"
                                    [ngClass]="child.badge.color || 'bg-blue-600'">
                                    {{ child.badge.text }}
                                </span>
                            </a>
                        </ng-container>
                    </div>
                </div>

            </ng-container>

        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            @if (user$ | async; as user) {
            <div class="user-profile" [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                <div class="user-avatar">
                    @if (user.photoURL) {
                    <img [src]="user.photoURL" [alt]="(userProfile$ | async)?.displayName || user.displayName">
                    } @else {
                    <div class="avatar-placeholder">
                        <app-icon name="user" [size]="20"></app-icon>
                    </div>
                    }
                </div>
                <div class="user-info">
                    <span class="user-name">{{ (userProfile$ | async)?.displayName || user.displayName || 'User'
                        }}</span>
                    <span class="user-email">{{ user.email }}</span>
                </div>
            </div>
            }
            <button (click)="logout()" class="logout-link" [title]="'OPERATIONS.LOGOUT' | translate">
                <span class="icon"><app-icon name="log-out" [size]="20"></app-icon></span>
                <span class="text">{{ 'OPERATIONS.LOGOUT' | translate }}</span>
            </button>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="operations-content bg-zinc-950" [class.expanded]="isSidebarCollapsed()">
        <header class="operations-header bg-zinc-800/80 backdrop-blur-md border-b border-zinc-700 text-white">
            <div class="spacer"></div>

            <div class="header-actions-group">
                <!-- Language Switcher -->
                <button (click)="toggleLanguage()"
                    class="flex items-center justify-center w-8 h-8 rounded-lg border border-zinc-700 bg-zinc-800 text-zinc-300 hover:bg-zinc-700 hover:text-white hover:border-zinc-600 transition-all font-bold text-xs shadow-sm"
                    [title]="'Switch Language' | translate">
                    {{ languageService.currentLang() === 'es' ? 'EN' : 'ES' }}
                </button>

                @if (user$ | async; as user) {
                <div class="user-menu-container">
                    <button class="header-avatar" (click)="toggleUserMenu()"
                        [title]="(userProfile$ | async)?.displayName || user.displayName || user.email">
                        @if (user.photoURL) {
                        <img [src]="user.photoURL"
                            [alt]="(userProfile$ | async)?.displayName || user.displayName || 'User'">
                        } @else {
                        <div class="avatar-placeholder-sm">
                            <app-icon name="user" [size]="16"></app-icon>
                        </div>
                        }
                    </button>

                    @if (isUserMenuOpen) {
                    <div class="user-dropdown bg-zinc-800 border border-zinc-700 shadow-xl text-white">
                        <div class="dropdown-header border-b border-zinc-700">
                            <span class="d-name text-white">{{ (userProfile$ | async)?.displayName || user.displayName
                                || 'User'
                                }}</span>
                            @if (userProfile$ | async; as profile) {
                            <span class="d-role-badge bg-emerald-900/30 text-emerald-400">{{ profile.role }}</span>
                            }
                            <span class="d-email text-zinc-400">{{ user.email }}</span>
                        </div>
                        <div class="dropdown-divider bg-zinc-700"></div>
                        <a routerLink="/" class="dropdown-item hover:bg-zinc-700 text-zinc-300 hover:text-white">
                            <span class="icon"><app-icon name="home" [size]="16"></app-icon></span>
                            {{ 'OPERATIONS.GO_HOME' | translate }}
                        </a>
                        <button (click)="logout()" class="dropdown-item hover:bg-red-900/20 text-red-400">
                            <span class="icon"><app-icon name="log-out" [size]="16"></app-icon></span>
                            {{ 'OPERATIONS.LOGOUT' | translate }}
                        </button>
                    </div>
                    }
                </div>
                }
            </div>
        </header>

        <div class="content-wrapper">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>