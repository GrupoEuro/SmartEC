<app-admin-page-header iconName="tag" [title]="'OPERATIONS.PROMOTIONS.TITLE' | translate"
    [subtitle]="dataSource.pagination.totalItems + ' ' + ('OPERATIONS.PROMOTIONS.COUNT_LABEL' | translate)"
    variant="operations">
</app-admin-page-header>

<div class="list-container p-6 max-w-7xl mx-auto space-y-6">
    <!-- Filters Bar -->
    <div
        class="filters-bar bg-zinc-800 rounded-xl p-4 shadow-lg border border-zinc-700 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="search-and-filters flex flex-col md:flex-row gap-4 w-full md:w-auto">
            <div class="search-box relative w-full md:w-96">
                <span class="search-icon absolute left-3 top-1/2 -tranzinc-y-1/2 pointer-events-none">
                    <app-icon name="search" [size]="18" class="text-zinc-500"></app-icon>
                </span>
                <input type="text" [formControl]="searchControl"
                    [placeholder]="'OPERATIONS.PROMOTIONS.SEARCH_PLACEHOLDER' | translate"
                    class="w-full bg-zinc-900 border border-zinc-700 rounded-lg pl-10 pr-4 py-2.5 text-white placeholder-zinc-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all">
            </div>

            <div class="filter-group min-w-[200px]">
                <select [ngModel]="statusFilter()" (ngModelChange)="onStatusChange($event)"
                    class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-4 py-2.5 text-zinc-300 focus:border-indigo-500 focus:outline-none transition-colors appearance-none cursor-pointer">
                    <option value="all">{{ 'OPERATIONS.PROMOTIONS.FILTER_ALL' | translate }}</option>
                    <option value="active">{{ 'OPERATIONS.PROMOTIONS.FILTER_ACTIVE' | translate }}</option>
                    <option value="inactive">{{ 'OPERATIONS.PROMOTIONS.FILTER_INACTIVE' | translate }}</option>
                </select>
            </div>

            <!-- Export Button -->
            <button
                class="flex items-center justify-center gap-2 px-4 py-2 bg-zinc-700 hover:bg-zinc-600 text-white rounded-lg font-medium transition-colors border border-zinc-600"
                (click)="handleExport()" [title]="'OPERATIONS.PROMOTIONS.EXPORT_CSV' | translate">
                <app-icon name="download" [size]="16"></app-icon>
                <span class="whitespace-nowrap">{{ 'OPERATIONS.PROMOTIONS.EXPORT_CSV' | translate }}</span>
            </button>
        </div>
    </div>

    <!-- Table -->
    <div class="operations-table-container">
        <div class="overflow-x-auto">
            <table class="operations-table w-full text-left border-collapse">
                <thead class="bg-zinc-900/50 text-zinc-400 text-xs uppercase font-semibold">
                    <tr>
                        <th (click)="onSort('code')"
                            class="p-4 border-b border-zinc-700 cursor-pointer hover:bg-zinc-800/50 transition-colors select-none group">
                            <div class="flex items-center gap-2">
                                {{ 'OPERATIONS.PROMOTIONS.CODE' | translate }}
                                <span *ngIf="dataSource.sortField === 'code'" class="text-indigo-400">
                                    <app-icon
                                        [name]="dataSource.sortDirection === 'asc' ? 'chevron-up' : 'chevron-down'"
                                        [size]="14"></app-icon>
                                </span>
                            </div>
                        </th>
                        <th class="p-4 border-b border-zinc-700">{{ 'OPERATIONS.PROMOTIONS.VALUE' | translate }}</th>
                        <th class="p-4 border-b border-zinc-700">{{ 'OPERATIONS.PROMOTIONS.USAGE' | translate }}</th>
                        <th (click)="onSort('startDate')"
                            class="p-4 border-b border-zinc-700 cursor-pointer hover:bg-zinc-800/50 transition-colors select-none group">
                            <div class="flex items-center gap-2">
                                {{ 'OPERATIONS.PROMOTIONS.VALIDITY' | translate }}
                                <span *ngIf="dataSource.sortField === 'startDate'" class="text-indigo-400">
                                    <app-icon
                                        [name]="dataSource.sortDirection === 'asc' ? 'chevron-up' : 'chevron-down'"
                                        [size]="14"></app-icon>
                                </span>
                            </div>
                        </th>
                        <th class="p-4 border-b border-zinc-700">{{ 'OPERATIONS.PROMOTIONS.STATUS' | translate }}</th>
                    </tr>
                </thead>
                <tbody class="text-zinc-300 text-sm">
                    <tr *ngFor="let coupon of dataSource.displayedData"
                        class="border-b border-zinc-800 hover:bg-zinc-700/30 transition-colors">
                        <td class="p-4">
                            <div class="flex flex-col gap-1">
                                <span
                                    class="bg-zinc-900/50 border border-zinc-700 text-indigo-400 px-2 py-1 rounded font-mono text-xs font-bold w-fit">{{
                                    coupon.code }}</span>
                                <span class="text-xs text-zinc-500" *ngIf="coupon.description">{{ coupon.description
                                    }}</span>
                            </div>
                        </td>
                        <td class="p-4 font-mono font-bold text-white">
                            <span *ngIf="coupon.type === 'percentage'">{{ coupon.value }}%</span>
                            <span *ngIf="coupon.type === 'fixed_amount'">${{ coupon.value }}</span>
                        </td>
                        <td class="p-4 text-zinc-400">
                            {{ coupon.usageCount }} <span class="text-zinc-600" *ngIf="coupon.usageLimit">/ {{
                                coupon.usageLimit }}</span>
                        </td>
                        <td class="p-4">
                            <div class="flex items-center gap-2 text-zinc-400">
                                <span>{{ formatDate(coupon.startDate) | date:'mediumDate' }}</span>
                                <app-icon name="arrow-right" [size]="12" class="text-zinc-600"
                                    *ngIf="coupon.endDate"></app-icon>
                                <span *ngIf="coupon.endDate">{{ formatDate(coupon.endDate) | date:'mediumDate' }}</span>
                                <span *ngIf="!coupon.endDate" class="text-zinc-600 italic text-xs ml-1"> ({{
                                    'OPERATIONS.PROMOTIONS.NO_EXPIRY' |
                                    translate }})</span>
                            </div>
                        </td>
                        <td class="p-4">
                            <span
                                class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border"
                                [class.bg-emerald-900-10]="coupon.isActive" [class.text-emerald-400]="coupon.isActive"
                                [class.border-emerald-800]="coupon.isActive" [class.bg-zinc-800]="!coupon.isActive"
                                [class.text-zinc-500]="!coupon.isActive" [class.border-zinc-700]="!coupon.isActive">
                                <span class="w-1.5 h-1.5 rounded-full" [class.bg-emerald-400]="coupon.isActive"
                                    [class.bg-zinc-500]="!coupon.isActive"></span>
                                {{ (coupon.isActive ? 'OPERATIONS.PROMOTIONS.ACTIVE_STATUS' :
                                'OPERATIONS.PROMOTIONS.INACTIVE_STATUS') |
                                translate }}
                            </span>
                        </td>
                    </tr>

                    <tr *ngIf="dataSource.displayedData.length === 0">
                        <td colspan="5" class="p-12 text-center text-zinc-500">
                            <div class="flex flex-col items-center gap-4">
                                <app-icon name="tag" [size]="48" class="text-zinc-600 opacity-50"></app-icon>
                                <h3 class="text-white font-medium">{{ 'OPERATIONS.PROMOTIONS.NO_DATA' | translate }}
                                </h3>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <app-pagination [config]="dataSource.pagination" [translationPrefix]="'OPERATIONS.PROMOTIONS'"
        (pageChange)="onPageChange($event)">
    </app-pagination>
</div>