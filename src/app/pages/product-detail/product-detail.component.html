<div class="product-detail-container" *ngIf="product$ | async as product; else loading">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a routerLink="/">{{ 'PRODUCT_DETAIL.BREADCRUMB_HOME' | translate }}</a>
        <span class="separator">â€º</span>
        <a routerLink="/catalog">{{ 'PRODUCT_DETAIL.BREADCRUMB_CATALOG' | translate }}</a>
        <span class="separator">â€º</span>
        <span class="current">{{ product.name.es }}</span>
    </nav>

    <!-- Hero Section -->
    <div class="product-hero">
        <!-- Image Gallery -->
        <div class="hero-left">
            <app-image-gallery [images]="getProductImages(product)" [productName]="product.name.es">
            </app-image-gallery>
        </div>

        <!-- Product Info -->
        <div class="hero-right">
            <div class="product-header">
                <span class="product-brand-badge">{{ product.brand }}</span>
                <p class="product-sku">{{ 'PRODUCT_DETAIL.SKU' | translate }}: {{ product.sku }}</p>
            </div>

            <h1 class="product-title">{{ product.name.es }}</h1>

            <!-- Price & Stock Group -->
            <div class="price-stock-group">
                <div class="price-section">
                    <div class="price-main">
                        <span class="current-price">{{ product.price | currency:'MXN':'symbol-narrow':'1.2-2' }}</span>
                        <span class="currency-label">MXN</span>
                    </div>

                    <div class="price-secondary" *ngIf="product.compareAtPrice">
                        <span class="original-price">{{ product.compareAtPrice | currency:'MXN':'symbol-narrow':'1.2-2'
                            }}</span>
                        <span class="discount-badge">
                            -{{ ((product.compareAtPrice - product.price) / product.compareAtPrice * 100).toFixed(0) }}%
                        </span>
                    </div>

                    <div class="tax-info">{{ 'COMMON.IVA_INCLUDED' | translate }}</div>
                </div>

                <!-- Stock Status -->
                <div class="stock-status" [class.is-available]="product.inStock"
                    [class.not-available]="!product.inStock">
                    <div class="stock-indicator"></div>
                    <span *ngIf="product.inStock">
                        {{ 'PRODUCT_DETAIL.IN_STOCK' | translate }}
                        <span class="stock-qty">({{ product.stockQuantity }} {{ 'PRODUCT_DETAIL.UNITS_AVAILABLE' |
                            translate }})</span>
                    </span>
                    <span *ngIf="!product.inStock">{{ 'PRODUCT_DETAIL.OUT_OF_STOCK' | translate }}</span>
                </div>
            </div>

            <!-- Tire Size -->
            <div class="tire-size-display">
                <div class="size-icon">ðŸ›ž</div>
                <div class="size-content">
                    <label>{{ 'PRODUCT_DETAIL.TIRE_SIZE' | translate }}</label>
                    <div class="size-value">
                        {{ product.specifications['width'] }}/{{ product.specifications['aspectRatio'] }}R{{
                        product.specifications['diameter'] }}
                    </div>
                </div>
            </div>

            <!-- Key Specs -->
            <div class="key-specs">
                <div class="spec-item">
                    <span class="spec-label">{{ 'PRODUCT_DETAIL.LOAD_INDEX' | translate }}</span>
                    <span class="spec-value">{{ product.specifications['loadIndex'] }}</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEED_RATING' | translate }}</span>
                    <span class="spec-value">{{ product.specifications['speedRating'] }}</span>
                </div>
            </div>

            <!-- Quantity Selector -->
            <div class="quantity-section">
                <label>{{ 'PRODUCT_DETAIL.QUANTITY' | translate }}</label>
                <div class="quantity-controls">
                    <button class="qty-btn" (click)="decrementQuantity()">âˆ’</button>
                    <input type="number" [(ngModel)]="quantity" min="1" class="qty-input" />
                    <button class="qty-btn" (click)="incrementQuantity()">+</button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-add-cart" (click)="addToCart(product)" [disabled]="!product.inStock">
                    <span class="btn-icon">ðŸ›’</span>
                    {{ 'PRODUCT_DETAIL.ADD_TO_CART' | translate }}
                </button>
                <button class="btn-wishlist" (click)="addToWishlist(product)"
                    title="{{ 'PRODUCT_DETAIL.ADD_TO_WISHLIST' | translate }}">
                    â™¡
                </button>
                <button class="btn-share" (click)="shareProduct()" title="{{ 'PRODUCT_DETAIL.SHARE' | translate }}">
                    â¤´
                </button>
            </div>

            <!-- Trust Signals -->
            <div class="trust-signals">
                <div class="trust-item secure">
                    <div class="trust-icon">ðŸ”’</div>
                    <div class="trust-text">
                        <strong>{{ 'PRODUCT_DETAIL.SECURE_PAYMENT' | translate }}</strong>
                        <div class="payment-methods-row">
                            <span class="pay-icon" title="Visa">VISA</span>
                            <span class="pay-icon" title="Mastercard">MC</span>
                            <span class="pay-icon" title="Amex">AMEX</span>
                            <span class="pay-icon" title="OXXO">OXXO</span>
                            <span class="pay-icon" title="MercadoPago">MP</span>
                        </div>
                    </div>
                </div>
                <div class="trust-item shipping">
                    <div class="trust-icon">ðŸšš</div>
                    <div class="trust-text">
                        <strong>{{ 'COMMON.FREE_SHIPPING' | translate }}</strong>
                        <span>{{ 'PRODUCT_DETAIL.SHIPPING_THRESHOLD' | translate }}</span>
                    </div>
                </div>
            </div>

            <!-- Badges -->
            <div class="product-badges-info">
                <span *ngIf="product.newArrival" class="info-badge badge-new">{{ 'PRODUCT_DETAIL.BADGES.NEW' | translate
                    }}</span>
                <span *ngIf="product.bestSeller" class="info-badge badge-bestseller">{{
                    'PRODUCT_DETAIL.BADGES.BESTSELLER' | translate }}</span>
                <span *ngIf="product.featured" class="info-badge badge-featured">{{ 'PRODUCT_DETAIL.BADGES.FEATURED' |
                    translate }}</span>
            </div>
        </div>
    </div>


    <!-- Frequently Bought Together (Bundles) -->
    <app-product-bundles [mainProduct]="product"></app-product-bundles>

    <!-- Specifications Table -->
    <div class="specifications-section">
        <h2 class="section-title">{{ 'PRODUCT_DETAIL.SPECIFICATIONS' | translate }}</h2>
        <div class="specs-grid">
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_WIDTH' | translate }}</span>
                <span class="spec-value">{{ product.specifications['width'] }} mm</span>
            </div>
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_ASPECT_RATIO' | translate }}</span>
                <span class="spec-value">{{ product.specifications['aspectRatio'] }}%</span>
            </div>
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_DIAMETER' | translate }}</span>
                <span class="spec-value">{{ product.specifications['diameter'] }}"</span>
            </div>
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_LOAD_INDEX' | translate }}</span>
                <span class="spec-value">{{ product.specifications['loadIndex'] }}</span>
            </div>
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_SPEED_RATING' | translate }}</span>
                <span class="spec-value">{{ product.specifications['speedRating'] }}</span>
            </div>
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_CONSTRUCTION' | translate }}</span>
                <span class="spec-value">{{ product.specifications['construction'] }}</span>
            </div>
            <div class="spec-row">
                <span class="spec-label">{{ 'PRODUCT_DETAIL.SPEC_TUBELESS' | translate }}</span>
                <span class="spec-value">{{ product.specifications['tubeless'] ? ('PRODUCT_DETAIL.SPEC_TUBELESS_YES' |
                    translate) : ('PRODUCT_DETAIL.SPEC_TUBELESS_NO' | translate) }}</span>
            </div>
        </div>
    </div>

    <!-- Tabbed Content -->
    <div class="tabs-section">
        <div class="tabs-header">
            <button class="tab-btn" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
                {{ 'PRODUCT_DETAIL.TABS.OVERVIEW' | translate }}
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'features'" (click)="setActiveTab('features')">
                {{ 'PRODUCT_DETAIL.TABS.FEATURES' | translate }}
            </button>
        </div>

        <div class="tabs-content">
            <!-- Overview Tab -->
            <div class="tab-panel" *ngIf="activeTab === 'overview'">
                <h3>{{ 'PRODUCT_DETAIL.DESCRIPTION' | translate }}</h3>
                <p class="description-text">{{ product.description.es }}</p>
            </div>

            <!-- Features Tab -->
            <div class="tab-panel" *ngIf="activeTab === 'features'">
                <h3>{{ 'PRODUCT_DETAIL.KEY_FEATURES' | translate }}</h3>
                <ul class="features-list">
                    <li *ngFor="let feature of product.features.es">{{ feature }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Mobile Sticky Buy Bar -->
    <div class="sticky-buy-bar" *ngIf="product$ | async as product">
        <div class="sticky-info">
            <span class="sticky-title">{{ product.name.es }}</span>
            <span class="sticky-price">{{ product.price | currency:'MXN':'symbol-narrow':'1.0-0' }}</span>
        </div>
        <button class="btn-sticky-add" (click)="addToCart(product)" [disabled]="!product.inStock">
            {{ 'PRODUCT_DETAIL.ADD_TO_CART' | translate }}
        </button>
    </div>

    <!-- Related Products -->
    <app-related-products *ngIf="relatedProducts$ | async as relatedProducts"
        [products]="relatedProducts"></app-related-products>
</div>

<!-- Loading State -->
<ng-template #loading>
    <div class="loading-state">
        <p>{{ 'PRODUCT_DETAIL.LOADING' | translate }}</p>
    </div>
</ng-template>